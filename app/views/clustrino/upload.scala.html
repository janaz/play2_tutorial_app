@import helper._

@import controllers.clustrino._
@main("Clustrino") {

    <h3>Hello logged in user!</h3>
    <ul class="nav nav-tabs">
        <li class="active"><a href="#">Upload CSV</a></li>
        <li class="disabled"><a href="#">View data</a></li>
        <li class="disabled"><a href="#">Profile</a></li>
    </ul>

    <div class="upload-alert alert alert-success" style="display: none;">
    </div>
    <span class="btn btn-success fileinput-button">
        <i class="glyphicon glyphicon-plus"></i>
        <span>Add files</span>
        <input id="fileupload" type="file" name="files[]" data-url="@controllers.clustrino.routes.BasicFlow.uploadFile()" multiple="">
    </span>

    <div class="data-context hidden">
        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-upload"></span> Upload</button>
        <span>Choosen File: </span><span class="filename"></span>
    </div>
    <script src="@controllers.routes.Assets.at("javascripts/ui/jquery-ui.js")"></script>
    <script src="@controllers.routes.Assets.at("javascripts/jquery.iframe-transport.js")"></script>
    <script src="@controllers.routes.Assets.at("javascripts/jquery.fileupload.js")"></script>
    <script>
    $(function () {
        $('#fileupload').fileupload({
            dataType: 'json',
            add: function (e, data) {
                $('.progress').addClass('hidden');
                $('.upload-alert').addClass('hidden');
                $('.fileinput-button').addClass('hidden');
                console.log("ADD");
                console.log(data);
                $('.data-context').removeClass('hidden');
                $('.data-context .filename').html(data.files[0].name + "("+data.files[0].size+ "bytes)");

                $('.data-context .btn' ).click(function () {
                            $('.data-context' ).addClass('hidden');
                            $('.progress').removeClass('hidden');
                            $('.progress .progress-bar').css('width', '0');
                            data.submit();
                        });
            },
            done: function (e, data) {
                var response = data.result;
                console.log(response);
                $('.progress').addClass('hidden');
                $('.upload-alert' ).removeClass('hidden').html('File uploaded successfully' +response.message + '<a href="@controllers.clustrino.routes.BasicFlow.showFile()">Display the content</a>').slideDown();
            },
            progressall: function (e, data) {
                var progress = parseInt(data.loaded / data.total * 100, 10);
                $('.progress .progress-bar').css(
                    'width',
                    progress + '%'
                    ).attr('aria-valuenow', progress);
                $('.progress .progress-bar .sr-only' ).html(progress + '% complete');
                }
            });
    });
    </script>

    <div class="progress hidden">
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0;">
            <span class="sr-only"></span>
        </div>
    </div>
}
