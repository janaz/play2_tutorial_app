@(content: Html)

@import helper._

@import controllers.clustrino._

@if(request.getHeader("X-PJAX") != null) {
    @content
} else {
    @main("Clustrino") {

        <div class="upload-alert alert alert-success" style="display: none;">
        </div>

        <div class="progress progress-striped hidden">
            <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0;">
                <span class="progress-percentage"></span>
            </div>
        </div>

        <script src="@controllers.routes.Assets.at("javascripts/ui/jquery-ui.js")"></script>
        <script src="@controllers.routes.Assets.at("javascripts/jquery.iframe-transport.js")"></script>
        <script src="@controllers.routes.Assets.at("javascripts/jquery.fileupload.js")"></script>
        <script src="@controllers.routes.Assets.at("javascripts/jquery.handsontable.full.js")"></script>
        <script src="@controllers.routes.Assets.at("javascripts/jquery.handsontable.removeRow.js")"></script>

        <link rel="stylesheet" media="screen" href="@controllers.routes.Assets.at("stylesheets/jquery.handsontable.full.css")">
        <link rel="stylesheet" media="screen" href="@controllers.routes.Assets.at("stylesheets/jquery.handsontable.bootstrap.css")">
        <link rel="stylesheet" media="screen" href="@controllers.routes.Assets.at("stylesheets/jquery.handsontable.removeRow.css")">

        <script>
        var initUpload = function () {
            $('#fileupload').fileupload({
                dataType: 'json',
                fileName: '',
                add: function (e, data) {
                    $('.progress').addClass('hidden');
                    $('.upload-alert').addClass('hidden');
                    $('.fileinput-button').addClass('hidden');
                    console.log("ADD");
                    console.log(data);
                    $('.data-context').removeClass('hidden');
                    $('.data-context .filename').html(data.files[0].name + "("+data.files[0].size+ "bytes)");
                    var that = this;
                    $('.data-context .btn' ).click(function () {
                                $('.data-context' ).addClass('hidden');
                                $('.progress').removeClass('hidden');
                                $('.progress .progress-bar').css('width', '0');
                                that.fileName = data.originalFiles[0].name;
                                data.submit();
                            });
                },
                done: function (e, data) {
                    var response = data.result;
                    console.log(response);
                    $('.progress').addClass('hidden');
                    $('.upload-alert' ).removeClass('hidden').html('File uploaded successfully' +response.message + '<a href="@controllers.clustrino.secured.routes.UploadedFile.showFile()">Display the content</a>').slideDown();
                },
                progressall: function (e, data) {
                    var progress = parseInt(data.loaded / data.total * 100, 10);
                    $('.progress .progress-bar').css(
                        'width',
                        progress + '%'
                        ).attr('aria-valuenow', progress);
                    $('.progress .progress-bar .progress-percentage' ).html('Uploading ' + this.fileName +' '+ progress + '% complete');
                }
            });
        };
        </script>
        <h3>Hello logged in user!</h3>
        <div id="pjax-container">
            @content
        </div>

        <script>
        $(document).pjax('a[data-pjax]', '#pjax-container');
        $(document).on('pjax:complete', function() {
            console.log('pjax complete');
            $(document).pjax('a[data-pjax]', '#pjax-container');
        });
        </script>

    }
}